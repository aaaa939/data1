<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»¥é¢¨æš´é æ¸¬æœªä¾†,ä»¥æš—ç¶²å®ˆè­·å¤©ç©º(è¨ªå®¢é–å®šç‰ˆ)</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#6366f1',
                        darkBg: '#0f172a',
                        cardBg: '#1e293b',
                        gray: { 750: '#2d3748', 850: '#1a202c', 950: '#0d1117' }
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- å¼•å…¥å¤–éƒ¨åº« -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; overflow-x: hidden; }
        * { transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease; }
        #map { height: 450px; width: 100%; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255,255,255,0.1); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .weather-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .pulse-red { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .weather-icon-float { animation: floating 3s ease-in-out infinite; }
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .chart-wrapper { position: relative; height: 220px; width: 100%; }
        .hidden-section { display: none !important; }
        
        /* å°è¦½æŒ‰éˆ•æ¿€æ´»ç‹€æ…‹ */
        .nav-btn.active { color: #3b82f6; border-bottom: 2px solid #3b82f6; }
    </style>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- åˆå§‹åŒ–åƒæ•¸ ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'cyber-weather-app';
        const firebaseConfig = {
            apiKey: "AIzaSyCLQZLs031EHwgaaob0JVg05Kmwprd1_5g",
            authDomain: "aaaa-f400a.firebaseapp.com",
            databaseURL: "https://aaaa-f400a-default-rtdb.firebaseio.com",
            projectId: "aaaa-f400a",
            storageBucket: "aaaa-f400a.firebasestorage.app",
            messagingSenderId: "1016829883023",
            appId: "1:1016829883023:web:225c6286732aa6dd2d76fa",
            measurementId: "G-K82HD0NEZD"
        };
        
        let app, db, auth, mapInstance, userMarker, trendChartInstance;
        let currentUser = null;
        let isDark = true;
        let isRegisterMode = false;
        // æš«å­˜åœ–ç‰‡ Base64
        let tempAvatarBase64 = null;
        
        const apiKey = "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";
        const API_URL = "https://api.groq.com/openai/v1/chat/completions";
        const OPEN_METEO_URL = "https://api.open-meteo.com/v1/forecast";

        window.onload = async () => {
            initFirebase();
            setupEventListeners();
        };

        const initFirebase = async () => {
            try {
                app = initializeApp(firebaseConfig);
                const analytics = getAnalytics(app);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, (user) => {
                    currentUser = user;
                    if (user) {
                        showApp();
                    } else {
                        if (currentUser && currentUser.uid.startsWith('guest-offline')) return;
                        showAuthScreen();
                    }
                });
            } catch (e) {
                console.error("Firebase åˆå§‹åŒ–å¤±æ•—", e);
            }
        };

        const setupEventListeners = () => {
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            document.getElementById('weather-search-btn').onclick = searchWeather;
            
            document.getElementById('auth-submit-btn').addEventListener('click', handleAuthSubmit);
            document.getElementById('auth-toggle-btn').addEventListener('click', toggleAuthMode);
            document.getElementById('guest-login-btn').addEventListener('click', handleGuestLogin);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            document.getElementById('save-settings-btn').addEventListener('click', saveUserSettings);
            
            // å°è¦½æŒ‰éˆ•åˆ‡æ›
            document.getElementById('nav-dashboard-btn').addEventListener('click', () => switchPage('dashboard'));
            document.getElementById('nav-alert-btn').addEventListener('click', () => switchPage('alert'));
            document.getElementById('nav-settings-btn').addEventListener('click', () => switchPage('settings'));

            // é ­åƒä¸Šå‚³æŒ‰éˆ•ç›£è½
            document.getElementById('avatar-upload-btn').addEventListener('click', () => {
                document.getElementById('avatar-input').click();
            });
            document.getElementById('avatar-input').addEventListener('change', handleAvatarFileSelect);

            // ç½å®³é è­¦æ¸¬è©¦æŒ‰éˆ•ç›£è½
            document.getElementById('test-normal-btn').addEventListener('click', () => {
                const city = document.getElementById('display-city').textContent;
                updateAlertView(0, 0, 10, city + " (æ¨¡æ“¬)");
            });
            document.getElementById('test-rain-btn').addEventListener('click', () => {
                const city = document.getElementById('display-city').textContent;
                updateAlertView(100, 63, 10, city + " (æ¨¡æ“¬)");
            });
            document.getElementById('test-wind-btn').addEventListener('click', () => {
                const city = document.getElementById('display-city').textContent;
                updateAlertView(0, 0, 80, city + " (æ¨¡æ“¬)");
            });
            document.getElementById('test-danger-btn').addEventListener('click', () => {
                const city = document.getElementById('display-city').textContent;
                updateAlertView(100, 95, 80, city + " (æ¨¡æ“¬)");
            });
        };

        // --- è¦–åœ–åˆ‡æ›é‚è¼¯ (Auth vs App) ---
        function showApp() {
            document.getElementById('auth-view').classList.add('hidden-section');
            document.getElementById('app-container').classList.remove('hidden-section');
            document.getElementById('logout-btn').classList.remove('hidden-section');
            document.getElementById('main-nav-buttons').classList.remove('hidden-section');
            
            updateUserUI();
            
            // é è¨­é€²å…¥ Dashboard
            switchPage('dashboard');

            // è¼‰å…¥è¨­å®šèˆ‡åˆå§‹åŒ–åœ°åœ–
            loadUserSettings().then(settings => {
                const savedCity = settings?.defaultCity;
                if (!mapInstance) {
                    if (savedCity) {
                        searchCityAndLoad(savedCity);
                    } else {
                        initMap(25.0330, 121.5654);
                        updateWeather("å°åŒ—å¸‚", 25.0330, 121.5654);
                    }
                }
            });
        }

        function showAuthScreen() {
            document.getElementById('auth-view').classList.remove('hidden-section');
            document.getElementById('app-container').classList.add('hidden-section');
            document.getElementById('logout-btn').classList.add('hidden-section');
            document.getElementById('main-nav-buttons').classList.add('hidden-section');
            document.getElementById('user-uid-display').textContent = "";
            // é‡ç½®é ­åƒ
            document.getElementById('header-avatar').src = "https://ui-avatars.com/api/?name=User&background=3b82f6&color=fff";
        }

        // --- é é¢åˆ‡æ›é‚è¼¯ (Dashboard / Alert / Settings) ---
        function switchPage(pageId) {
            // [æ–°å¢] è¨ªå®¢é–å®šé‚è¼¯
            if (pageId === 'settings') {
                const isGuest = currentUser && (currentUser.isAnonymous || currentUser.uid.startsWith('guest-offline'));
                if (isGuest) {
                    alert("ğŸ”’ è¨ªå®¢æ¨¡å¼ç„¡æ³•ä½¿ç”¨å€‹äººåŒ–è¨­å®šåŠŸèƒ½ï¼Œè«‹è¨»å†Šæˆ–ç™»å…¥æœƒå“¡ã€‚");
                    return; // é˜»æ­¢åˆ‡æ›
                }
            }

            document.getElementById('dashboard-view').classList.add('hidden-section');
            document.getElementById('alert-view').classList.add('hidden-section');
            document.getElementById('settings-view').classList.add('hidden-section');

            document.getElementById('nav-dashboard-btn').classList.remove('active', 'text-blue-500', 'font-bold');
            document.getElementById('nav-alert-btn').classList.remove('active', 'text-blue-500', 'font-bold');
            document.getElementById('nav-settings-btn').classList.remove('active', 'text-blue-500', 'font-bold');

            if (pageId === 'dashboard') {
                document.getElementById('dashboard-view').classList.remove('hidden-section');
                document.getElementById('nav-dashboard-btn').classList.add('active', 'text-blue-500', 'font-bold');
                if(mapInstance) setTimeout(() => mapInstance.invalidateSize(), 100);
            } else if (pageId === 'alert') {
                document.getElementById('alert-view').classList.remove('hidden-section');
                document.getElementById('nav-alert-btn').classList.add('active', 'text-blue-500', 'font-bold');
            } else if (pageId === 'settings') {
                document.getElementById('settings-view').classList.remove('hidden-section');
                document.getElementById('nav-settings-btn').classList.add('active', 'text-blue-500', 'font-bold');
            }
        }

        // --- é ­åƒè™•ç†é‚è¼¯ ---
        function handleAvatarFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 1024 * 1024) {
                alert("åœ–ç‰‡å¤ªå¤§ï¼Œè«‹é¸æ“‡å°æ–¼ 1MB çš„åœ–ç‰‡");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const maxWidth = 200;
                    const scaleSize = maxWidth / img.width;
                    canvas.width = maxWidth;
                    canvas.height = img.height * scaleSize;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    
                    tempAvatarBase64 = canvas.toDataURL('image/jpeg', 0.7);
                    
                    document.getElementById('settings-avatar-preview').src = tempAvatarBase64;
                };
            };
            reader.readAsDataURL(file);
        }

        // --- è¨­å®šé‚è¼¯ (æ›´æ–°) ---
        async function loadUserSettings() {
            if (!currentUser || currentUser.uid.startsWith('guest-offline')) return null;
            try {
                const docRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'settings', 'preferences');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data.defaultCity) {
                        document.getElementById('setting-default-city').value = data.defaultCity;
                    }
                    if (data.avatar) {
                        document.getElementById('header-avatar').src = data.avatar;
                        document.getElementById('settings-avatar-preview').src = data.avatar;
                    }
                    // [æ–°å¢] è¼‰å…¥å§“åå’Œè‡ªæˆ‘ä»‹ç´¹
                    if (data.username) {
                        document.getElementById('setting-username').value = data.username;
                        document.getElementById('user-uid-display').textContent = data.username; // åŒæ­¥ Header
                    }
                    if (data.bio) {
                        document.getElementById('setting-bio').value = data.bio;
                    }
                    return data;
                }
            } catch (e) { console.error(e); }
            return null;
        }

        async function saveUserSettings() {
            const city = document.getElementById('setting-default-city').value.trim();
            const username = document.getElementById('setting-username').value.trim(); // [æ–°å¢]
            const bio = document.getElementById('setting-bio').value.trim(); // [æ–°å¢]
            
            if (!currentUser) return;
            const btn = document.getElementById('save-settings-btn');
            const originalText = btn.textContent;
            btn.textContent = "å„²å­˜ä¸­...";
            
            const settingsData = { defaultCity: city, username: username, bio: bio }; // [æ–°å¢]
            if (tempAvatarBase64) {
                settingsData.avatar = tempAvatarBase64;
            }

            try {
                if (!currentUser.uid.startsWith('guest-offline')) {
                    const docRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'settings', 'preferences');
                    await setDoc(docRef, settingsData, { merge: true });
                    
                    if (tempAvatarBase64) {
                        document.getElementById('header-avatar').src = tempAvatarBase64;
                    }
                    if (username) {
                        document.getElementById('user-uid-display').textContent = username; // [æ–°å¢] æ›´æ–° Header
                    }
                    
                    alert("è¨­å®šå·²å„²å­˜ï¼");
                } else {
                    alert("è¨ªå®¢æ¨¡å¼ç„¡æ³•é›²ç«¯å„²å­˜ï¼Œä½†æœ¬æ¬¡æ“ä½œæœ‰æ•ˆã€‚");
                    if (tempAvatarBase64) document.getElementById('header-avatar').src = tempAvatarBase64;
                    if (username) document.getElementById('user-uid-display').textContent = username;
                }
                if (city) searchCityAndLoad(city);
            } catch (e) { alert("å„²å­˜å¤±æ•—"); console.error(e); } 
            finally { btn.textContent = originalText; }
        }

        // --- Auth ç›¸é—œ ---
        function toggleAuthMode() {
            isRegisterMode = !isRegisterMode;
            document.getElementById('auth-title').textContent = isRegisterMode ? "è¨»å†Šæ–°å¸³è™Ÿ" : "ç³»çµ±ç™»å…¥";
            document.getElementById('auth-submit-btn').textContent = isRegisterMode ? "è¨»å†Š" : "ç™»å…¥";
            document.getElementById('auth-toggle-btn').textContent = isRegisterMode ? "å·²æœ‰å¸³è™Ÿï¼Ÿç™»å…¥" : "å»ºç«‹æ–°å¸³è™Ÿ";
            document.getElementById('auth-error').textContent = "";
        }

        async function handleAuthSubmit() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const errorMsg = document.getElementById('auth-error');
            if (!email || !password) { errorMsg.textContent = "è«‹è¼¸å…¥ Email å’Œå¯†ç¢¼"; return; }
            errorMsg.textContent = "è™•ç†ä¸­...";
            try {
                if (isRegisterMode) await createUserWithEmailAndPassword(auth, email, password);
                else await signInWithEmailAndPassword(auth, email, password);
            } catch (error) { errorMsg.textContent = "ç™»å…¥/è¨»å†Šå¤±æ•—: " + error.code; }
        }

        async function handleGuestLogin() {
            try { await signInAnonymously(auth); } 
            catch { currentUser = { uid: "guest-offline-" + Math.floor(Math.random()*1000), isAnonymous: true }; showApp(); }
        }

        async function handleLogout() {
            try { await signOut(auth); } catch {}
            currentUser = null;
            showAuthScreen();
        }

        // --- æ°£è±¡èˆ‡åœ°åœ– ---
        async function updateWeather(cityName, lat, lon) {
            const container = document.getElementById('weather-info-container');
            if (!container) return;
            container.classList.add('opacity-50');
            try {
                const params = new URLSearchParams({
                    latitude: lat, longitude: lon,
                    current: "temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m",
                    hourly: "temperature_2m,precipitation_probability,visibility",
                    timezone: "auto", forecast_days: 2
                });
                const response = await fetch(`${OPEN_METEO_URL}?${params.toString()}`);
                const weatherData = await response.json();
                const current = weatherData.current;
                const visibility = (weatherData.hourly?.visibility?.[0] || 10000) / 1000;

                document.getElementById('display-city').textContent = cityName;
                document.getElementById('display-temp').textContent = `${current.temperature_2m}Â°C`;
                document.getElementById('display-humidity').textContent = `${current.relative_humidity_2m}%`;
                document.getElementById('display-wind').textContent = `${current.wind_speed_10m} km/h`;
                document.getElementById('display-apparent').textContent = `${current.apparent_temperature}Â°C`;
                document.getElementById('display-rain').textContent = `${current.precipitation} mm`;
                document.getElementById('display-visibility').textContent = `${visibility} km`;
                document.getElementById('display-desc').textContent = getWeatherDesc(current.weather_code);
                
                // æ›´æ–°è­¦å ±é é¢ç‹€æ…‹
                updateAlertView(current.precipitation, current.weather_code, current.wind_speed_10m, cityName);

                renderTrendChart(weatherData.hourly);
                generateRiskReport(cityName, { ...current, visibility, desc: getWeatherDesc(current.weather_code) });
            } catch (err) { console.error(err); } 
            finally { container.classList.remove('opacity-50'); }
        }

        function updateAlertView(precipitation, weatherCode, windSpeed, city) {
            const isHeavyRain = precipitation > 2.0 || [63, 65, 81, 82, 95, 96, 99].includes(weatherCode);
            const isStrongWind = windSpeed > 40;
            
            const alertStatusDiv = document.getElementById('alert-status-container');
            if (isHeavyRain || isStrongWind) {
                alertStatusDiv.innerHTML = `
                    <div class="bg-red-500/10 border border-red-500 rounded-2xl p-8 text-center animate-fade-in">
                        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-red-500 text-white text-4xl mb-4 pulse-red">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-red-500 mb-2">ç½å®³é è­¦ç™¼å¸ƒä¸­</h3>
                        <p class="text-gray-400 mb-6">ç›£æ¸¬åœ°é»ï¼š${city}</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left max-w-2xl mx-auto">
                            ${isHeavyRain ? `<div class="bg-red-500/20 p-4 rounded-xl flex items-center"><i class="fas fa-cloud-showers-heavy text-red-400 text-xl mr-3"></i><div><p class="font-bold text-red-300">è±ªå¤§é›¨è­¦å ±</p><p class="text-xs text-red-200/70">é™é›¨å¼·åº¦åé«˜ï¼Œè«‹æ³¨æ„æ·¹æ°´é¢¨éšªã€‚</p></div></div>` : ''}
                            ${isStrongWind ? `<div class="bg-orange-500/20 p-4 rounded-xl flex items-center"><i class="fas fa-wind text-orange-400 text-xl mr-3"></i><div><p class="font-bold text-orange-300">å¼·é¢¨è­¦å ±</p><p class="text-xs text-orange-200/70">é¢¨é€Ÿéå¤§ï¼Œè«‹åŠ å›ºæˆ¶å¤–è¨­æ–½ã€‚</p></div></div>` : ''}
                        </div>
                    </div>
                `;
            } else {
                alertStatusDiv.innerHTML = `
                    <div class="bg-green-500/10 border border-green-500/30 rounded-2xl p-12 text-center animate-fade-in">
                        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-green-500/20 text-green-500 text-4xl mb-6">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-green-500 mb-2">ç›®å‰ç„¡ç½å®³è­¦å ±</h3>
                        <p class="text-gray-400">ç›£æ¸¬åœ°é»ï¼š${city} - å„é …æ•¸å€¼å‡åœ¨å®‰å…¨ç¯„åœå…§ã€‚</p>
                    </div>
                `;
            }
        }

        function renderTrendChart(hourlyData) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            const now = new Date();
            const currentHourStr = now.toISOString().slice(0, 13);
            let startIndex = hourlyData.time.findIndex(t => t.startsWith(currentHourStr));
            if (startIndex === -1) startIndex = 0;
            const labels = [], temps = [], rainProbs = [];
            for (let i = 0; i < 24; i++) {
                const idx = startIndex + i;
                if (idx < hourlyData.time.length) {
                    const time = new Date(hourlyData.time[idx]);
                    labels.push(`${time.getHours()}:00`);
                    temps.push(hourlyData.temperature_2m[idx]);
                    rainProbs.push(hourlyData.precipitation_probability[idx]);
                }
            }
            if (trendChartInstance) trendChartInstance.destroy();
            const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)';
            const textColor = isDark ? '#9ca3af' : '#4b5563';
            trendChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'é™é›¨æ©Ÿç‡ (%)', data: rainProbs, backgroundColor: 'rgba(59, 130, 246, 0.3)', yAxisID: 'y1', borderRadius: 4 },
                        { label: 'æ°£æº« (Â°C)', data: temps, type: 'line', borderColor: '#fbbf24', backgroundColor: 'rgba(251, 191, 36, 0.1)', yAxisID: 'y', fill: true, tension: 0.4 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: { grid: { display: false }, ticks: { color: textColor, maxTicksLimit: 8 } },
                        y: { grid: { color: gridColor }, ticks: { color: textColor } },
                        y1: { display: false, min: 0, max: 100 }
                    },
                    plugins: { legend: { labels: { color: textColor } } }
                }
            });
        }

        function getWeatherDesc(code) {
            const codes = { 0: "æ™´æœ—", 1: "ä¸»è¦æ™´æœ—", 2: "å¤šé›²", 3: "é™°å¤©", 45: "éœ§", 48: "æ²‰ç©éœ§", 51: "ç´°é›¨", 61: "å¾®é›¨", 71: "å°é›ª", 80: "é™£é›¨", 95: "é›·é›¨" };
            return codes[code] || "æœªçŸ¥ç‹€æ³";
        }

        // --- AI ç”Ÿæ´»å»ºè­°å ±å‘Š (å„ªåŒ–ç‰ˆ) ---
        async function generateRiskReport(city, data) {
            const reportEl = document.getElementById('risk-report-content');
            if (!reportEl) return;
            reportEl.innerHTML = '<div class="flex justify-center py-10"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';
            
            // å„ªåŒ–çš„ AI Prompt (ç”Ÿæ´»å»ºè­°)
            const prompt = `ä½ æ˜¯ä¸€ä½è²¼å¿ƒçš„æ°£è±¡ç”Ÿæ´»åŠ©ç†ã€‚è«‹é‡å°ä»¥ä¸‹å¯¦æ™‚æ°£è±¡æ•¸æ“šï¼Œç‚ºä½¿ç”¨è€…ç”Ÿæˆä¸€ä»½ç”Ÿæ´»å»ºè­°å ±å‘Šã€‚

**æ°£è±¡æ•¸æ“šï¼š**
* åŸå¸‚ï¼š${city}
* æ°£æº«ï¼š${data.temp}Â°C (é«”æ„Ÿï¼š${data.apparent}Â°C)
* æ¿•åº¦ï¼š${data.humidity}%
* é™é›¨é‡ï¼š${data.rain} mm
* é¢¨é€Ÿï¼š${data.wind} km/h
* èƒ½è¦‹åº¦ï¼š${data.visibility} km
* å¤©æ°£ç‹€æ³ï¼š${data.desc}

**å ±å‘Šè¦æ±‚ï¼ˆè«‹ä½¿ç”¨ Markdown æ ¼å¼ï¼‰ï¼š**

1.  ğŸŒ¤ï¸ **å¤©æ°£ç¶œè¿°**ï¼šç”¨ä¸€å¥è©±å½¢å®¹ç¾åœ¨çš„é«”æ„Ÿèˆ’é©åº¦ã€‚
2.  ğŸ‘• **ç©¿æ­å»ºè­°**ï¼šå»ºè­°ç©¿è‘—ä»€éº¼é¡å‹çš„è¡£ç‰©ï¼ˆä¾‹å¦‚ï¼šé€æ°£ã€ä¿æš–ã€æ”œå¸¶é›¨å…·ï¼‰ã€‚
3.  ğŸƒ **æ´»å‹•å»ºè­°**ï¼šé©åˆæˆ¶å¤–é‹å‹•é‚„æ˜¯å®¤å…§æ´»å‹•ï¼Ÿæœ‰ç„¡ç‰¹å®šæ³¨æ„äº‹é …ã€‚
4.  ğŸ¥ **å¥åº·å®åš€**ï¼šé‡å°æº«åº¦ã€æ¿•åº¦æˆ–é¢¨é€Ÿçš„å¥åº·æé†’ï¼ˆä¾‹å¦‚ï¼šå¤šå–æ°´ã€æ³¨æ„é˜²æ›¬ã€å°å¿ƒè·¯æ»‘ï¼‰ã€‚

è«‹ä¿æŒèªæ°£è¦ªåˆ‡ã€å¯¦ç”¨ã€‚`;
            
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                    body: JSON.stringify({ 
                        model: "llama-3.3-70b-versatile", 
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.7,
                        max_tokens: 1024
                    })
                });
                const result = await res.json();
                const text = result.choices?.[0]?.message?.content;
                if (text) {
                    reportEl.innerHTML = marked.parse(text);
                    // æ ¹æ“šå¤©æ°£ç‹€æ³æ›´æ–°é¢¨éšªæ¨™ç±¤ (é€™è£¡æŒ‡å¤©æ°£å½±éŸ¿ç¨‹åº¦)
                    const riskLevel = (data.rain > 10 || data.wind > 40 || data.temp > 35) ? "ä¸é©å®œæˆ¶å¤–" : (data.rain > 2 || data.humidity > 85 ? "éœ€æ³¨æ„" : "èˆ’é©");
                    const levelEl = document.getElementById('risk-level-tag');
                    if (levelEl) {
                        levelEl.textContent = riskLevel;
                        let colorClass = 'bg-green-500';
                        if (riskLevel === 'ä¸é©å®œæˆ¶å¤–') colorClass = 'bg-red-500 pulse-red';
                        else if (riskLevel === 'éœ€æ³¨æ„') colorClass = 'bg-yellow-500';
                        
                        levelEl.className = `px-3 py-1 rounded-full text-xs font-bold ${colorClass} text-white`;
                    }
                }
            } catch (e) { 
                console.error(e); 
                reportEl.innerHTML = "å ±å‘Šåˆ†ææš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹æª¢æŸ¥ API é€£ç·šã€‚"; 
            }
        }

        async function searchCityAndLoad(city) {
             try {
                const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}&limit=1&accept-language=zh-TW`);
                const data = await res.json();
                if(data.length > 0) {
                    const { lat, lon, display_name } = data[0];
                    if(!mapInstance) initMap(parseFloat(lat), parseFloat(lon));
                    updateWeather(display_name.split(',')[0], parseFloat(lat), parseFloat(lon));
                    updateMapPosition(parseFloat(lat), parseFloat(lon), display_name);
                }
            } catch (e) { console.error(e); }
        }

        async function searchWeather() {
            const city = document.getElementById('weather-search-input').value;
            if(!city) return;
            searchCityAndLoad(city);
        }

        function initMap(lat, lon) {
            const mapEl = document.getElementById('map');
            if (!mapEl) return;
            if (mapInstance) mapInstance.remove();
            mapInstance = L.map('map', { zoomControl: false }).setView([lat, lon], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapInstance);
            userMarker = L.marker([lat, lon]).addTo(mapInstance).bindPopup("ç›£æ§é»").openPopup();
        }

        function updateMapPosition(lat, lon, label) {
            if(userMarker) mapInstance.removeLayer(userMarker);
            userMarker = L.marker([lat, lon]).addTo(mapInstance).bindPopup(label).openPopup();
            mapInstance.flyTo([lat, lon], 13);
        }

        function toggleTheme() {
            isDark = !isDark;
            document.documentElement.classList.toggle('dark');
            if (trendChartInstance) {
                const textColor = isDark ? '#9ca3af' : '#4b5563';
                trendChartInstance.options.scales.x.ticks.color = textColor;
                trendChartInstance.options.scales.y.ticks.color = textColor;
                trendChartInstance.update();
            }
        }

        function updateUserUI() {
            if(currentUser) {
                const type = currentUser.isAnonymous ? "è¨ªå®¢" : "æœƒå“¡";
                // é€™è£¡æœƒå…ˆé¡¯ç¤º UIDï¼Œç¨å¾Œ loadUserSettings æœƒæ›´æ–°ç‚ºå§“å
                document.getElementById('user-uid-display').textContent = `${type}: ${currentUser.uid.substring(0,6)}...`;
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-darkBg text-gray-900 dark:text-gray-100 flex flex-col min-h-screen">

    <header class="sticky top-0 z-50 glass-morphism border-b border-white/10 px-6 py-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/30">
                    <i class="fas fa-shield-alt text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">ä»¥é¢¨æš´é æ¸¬æœªä¾†,ä»¥æš—ç¶²å®ˆè­·å¤©ç©º<span class="text-blue-500 text-sm"></span></h1>
                    <p class="text-[10px] uppercase tracking-widest text-gray-500">REAL-TIME RISK MONITORING</p>
                </div>
            </div>
            
            <!-- å°è¦½æŒ‰éˆ•å€ -->
            <div id="main-nav-buttons" class="hidden-section hidden md:flex items-center space-x-8 mx-4">
                <button id="nav-dashboard-btn" class="nav-btn text-sm font-medium text-gray-400 hover:text-white transition-all pb-1 active">å„€éŒ¶æ¿</button>
                <button id="nav-alert-btn" class="nav-btn text-sm font-medium text-gray-400 hover:text-red-400 transition-all pb-1">ç½å®³é è­¦</button>
                <button id="nav-settings-btn" class="nav-btn text-sm font-medium text-gray-400 hover:text-blue-400 transition-all pb-1">å€‹äººåŒ–è¨­å®š</button>
            </div>

            <div class="flex items-center space-x-4">
                <div id="user-uid-display" class="hidden md:block text-xs font-mono text-blue-400 bg-black/20 px-3 py-1 rounded-full"></div>
                <!-- Header ä½¿ç”¨è€…é ­åƒ -->
                <img id="header-avatar" src="https://ui-avatars.com/api/?name=User&background=3b82f6&color=fff" alt="User Avatar" class="w-8 h-8 rounded-full border-2 border-white/20 object-cover">
                
                <button id="theme-toggle" class="hover:text-blue-500 transition-colors w-8 h-8 flex items-center justify-center"><i class="fas fa-moon text-xl"></i></button>
                <button id="logout-btn" class="hidden-section bg-red-500/20 hover:bg-red-500 text-red-400 hover:text-white px-3 py-1 rounded-lg text-xs font-bold transition-all border border-red-500/30">
                    <i class="fas fa-sign-out-alt mr-1"></i> ç™»å‡º
                </button>
            </div>
        </div>
    </header>

    <main class="flex-1 container mx-auto p-4 md:p-8 flex flex-col relative">
        
        <!-- 1. ç™»å…¥/è¨»å†Šè¦–åœ– -->
        <div id="auth-view" class="flex-1 flex items-center justify-center min-h-[500px]">
            <div class="w-full max-w-md bg-white dark:bg-cardBg p-8 rounded-2xl shadow-2xl border border-gray-200 dark:border-white/5 relative overflow-hidden">
                <div class="absolute top-0 right-0 -mr-16 -mt-16 w-32 h-32 bg-blue-500 rounded-full blur-3xl opacity-20"></div>
                <div class="absolute bottom-0 left-0 -ml-16 -mb-16 w-32 h-32 bg-purple-500 rounded-full blur-3xl opacity-20"></div>
                
                <div class="relative z-10 text-center">
                    <div class="mb-6 inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-500/10 text-blue-500 text-2xl"><i class="fas fa-user-shield"></i></div>
                    <h2 id="auth-title" class="text-2xl font-bold mb-2">ç³»çµ±ç™»å…¥</h2>
                    <p class="text-gray-500 text-sm mb-8">å­˜å–å³æ™‚è³‡å®‰èˆ‡æ°£è±¡é¢¨éšªæ•¸æ“š</p>
                    <div class="space-y-4 text-left">
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1 ml-1">Email</label>
                            <input type="email" id="auth-email" class="w-full bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-3 outline-none focus:border-blue-500 transition-all" placeholder="name@company.com">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1 ml-1">å¯†ç¢¼</label>
                            <input type="password" id="auth-password" class="w-full bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-3 outline-none focus:border-blue-500 transition-all" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        </div>
                        <p id="auth-error" class="text-red-500 text-xs font-bold h-4"></p>
                        <button id="auth-submit-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-600/30 transition-all">ç™»å…¥</button>
                    </div>
                    <div class="mt-6 flex flex-col space-y-3">
                        <button id="auth-toggle-btn" class="text-sm text-gray-500 hover:text-blue-500 transition-colors">å»ºç«‹æ–°å¸³è™Ÿ</button>
                        <button id="guest-login-btn" class="text-xs font-bold text-gray-400 hover:text-gray-200 border border-gray-200 dark:border-white/10 rounded-lg py-2 hover:bg-white/5 transition-all">ä»¥è¨ªå®¢èº«ä»½è©¦ç”¨ <i class="fas fa-arrow-right ml-1"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- APP ä¸»å®¹å™¨ -->
        <div id="app-container" class="hidden-section flex-1 relative">
            
            <!-- 2. å„€éŒ¶æ¿é é¢ -->
            <div id="dashboard-view" class="space-y-8 animate-fade-in">
                <section class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <div class="lg:col-span-1 weather-card rounded-2xl p-6 flex flex-col justify-between">
                        <div>
                            <h3 class="text-white font-bold mb-4 flex items-center"><i class="fas fa-search-location mr-2 text-blue-400"></i> åœ°é»ç›£æ¸¬</h3>
                            <div class="space-y-4">
                                <input type="text" id="weather-search-input" placeholder="è¼¸å…¥åŸå¸‚ (å¦‚: å°åŒ—)" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:ring-2 focus:ring-blue-500 outline-none">
                                <button id="weather-search-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition-all">æ›´æ–°åˆ†æ</button>
                            </div>
                        </div>
                        <div class="mt-8 flex justify-center opacity-30"><i class="fas fa-satellite-dish text-6xl text-white"></i></div>
                    </div>

                    <div id="weather-info-container" class="lg:col-span-3 bg-white dark:bg-cardBg rounded-2xl p-8 border border-gray-200 dark:border-white/5 shadow-xl">
                        <div class="flex flex-wrap items-center justify-between mb-8">
                            <div class="flex items-center space-x-6">
                                <div class="weather-icon-float text-6xl text-blue-400"><i class="fas fa-cloud-sun-bolt"></i></div>
                                <div>
                                    <h2 id="display-city" class="text-4xl font-black mb-1">å°åŒ—å¸‚</h2>
                                    <p id="display-desc" class="text-gray-500 font-medium italic">åµæ¸¬ä¸­...</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-400 uppercase mb-1">å³æ™‚æ°£æº«</p>
                                <span id="display-temp" class="text-5xl font-black text-blue-500 tracking-tighter">--Â°C</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-6 text-center mb-8">
                            <div class="bg-gray-100 dark:bg-white/5 p-4 rounded-xl"><p class="text-[10px] text-gray-400 mb-1">é«”æ„Ÿ</p><span id="display-apparent" class="font-bold">--Â°C</span></div>
                            <div class="bg-gray-100 dark:bg-white/5 p-4 rounded-xl"><p class="text-[10px] text-gray-400 mb-1">æ¿•åº¦</p><span id="display-humidity" class="font-bold">--%</span></div>
                            <div class="bg-gray-100 dark:bg-white/5 p-4 rounded-xl"><p class="text-[10px] text-gray-400 mb-1">é™é›¨é‡</p><span id="display-rain" class="font-bold">-- mm</span></div>
                            <div class="bg-gray-100 dark:bg-white/5 p-4 rounded-xl"><p class="text-[10px] text-gray-400 mb-1">é¢¨é€Ÿ</p><span id="display-wind" class="font-bold">-- km/h</span></div>
                            <div class="bg-gray-100 dark:bg-white/5 p-4 rounded-xl"><p class="text-[10px] text-gray-400 mb-1">èƒ½è¦‹åº¦</p><span id="display-visibility" class="font-bold">-- km</span></div>
                        </div>
                        <div class="border-t border-gray-200 dark:border-white/5 pt-6">
                            <div class="flex justify-between items-end mb-4">
                                <div><h3 class="font-bold text-gray-700 dark:text-gray-200"><i class="fas fa-chart-line mr-2 text-primary"></i>æœªä¾† 24 å°æ™‚è¶¨å‹¢</h3><p class="text-xs text-gray-500 dark:text-gray-400">Temperature & Precipitation Forecast</p></div>
                            </div>
                            <div class="chart-wrapper"><canvas id="trendChart"></canvas></div>
                        </div>
                    </div>
                </section>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 bg-white dark:bg-cardBg p-6 rounded-2xl shadow-xl h-[550px] flex flex-col border border-white/5">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold flex items-center"><i class="fas fa-robot mr-2 text-blue-500"></i> AI ç”Ÿæ´»æ°£è±¡åŠ©ç†</h3>
                            <div id="risk-level-tag" class="px-3 py-1 rounded-full text-xs font-bold bg-gray-500 text-white">ç­‰å¾…ä¸­</div>
                        </div>
                        <div id="risk-report-content" class="flex-1 overflow-y-auto prose dark:prose-invert prose-sm scrollbar-thin"><p class="text-gray-500 italic">æ­£åœ¨é‹ç”¨ Groq AI åˆ†ææ°£è±¡ä¸¦æä¾›ç”Ÿæ´»å»ºè­°...</p></div>
                    </div>
                    <div class="lg:col-span-2 bg-white dark:bg-cardBg p-6 rounded-2xl shadow-xl h-[550px] flex flex-col border border-white/5">
                        <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold"><i class="fas fa-map-marked-alt mr-2 text-indigo-500"></i> ç›£æ§åœ°ç†ç¯€é»</h3></div>
                        <div id="map" class="flex-1"></div>
                    </div>
                </div>
            </div>

            <!-- 3. è±ªå¤§é›¨/æƒ¡åŠ£å¤©æ°£è­¦å ±é é¢ -->
            <div id="alert-view" class="hidden-section w-full h-full flex items-start justify-center pt-10 animate-fade-in">
                <div class="w-full max-w-4xl">
                    <div class="flex items-center justify-between mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center"><i class="fas fa-broadcast-tower text-red-500 mr-3"></i> ç½å®³é è­¦ä¸­å¿ƒ</h2>
                        <span class="text-sm text-gray-500">å³æ™‚ç›£æ§ï¼šæº«åº¦ã€é¢¨é€Ÿã€é™é›¨é‡</span>
                    </div>
                    
                    <div id="alert-status-container">
                        <!-- é€™è£¡æœƒç”± JS å‹•æ…‹æ’å…¥å…§å®¹ -->
                        <div class="bg-gray-100 dark:bg-white/5 rounded-2xl p-12 text-center">
                            <p class="text-gray-500">æ­£åœ¨è®€å–æ°£è±¡æ•¸æ“š...</p>
                        </div>
                    </div>

                    <!-- æ¸¬è©¦æ§åˆ¶å€ -->
                    <div class="mt-6 flex justify-center space-x-4">
                        <button id="test-normal-btn" class="px-4 py-2 bg-green-500/10 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-all text-xs font-bold border border-green-500/30">æ¨¡æ“¬æ­£å¸¸</button>
                        <button id="test-rain-btn" class="px-4 py-2 bg-blue-500/10 text-blue-500 hover:bg-blue-500 hover:text-white rounded-lg transition-all text-xs font-bold border border-blue-500/30">æ¨¡æ“¬è±ªé›¨</button>
                        <button id="test-wind-btn" class="px-4 py-2 bg-orange-500/10 text-orange-500 hover:bg-orange-500 hover:text-white rounded-lg transition-all text-xs font-bold border border-orange-500/30">æ¨¡æ“¬å¼·é¢¨</button>
                        <button id="test-danger-btn" class="px-4 py-2 bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white rounded-lg transition-all text-xs font-bold border border-red-500/30">æ¨¡æ“¬è¤‡åˆç½å®³</button>
                    </div>

                    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white dark:bg-cardBg p-6 rounded-xl border border-gray-200 dark:border-white/5 shadow-lg">
                            <h4 class="font-bold mb-2 text-gray-700 dark:text-gray-200">é˜²ç¯„è±ªé›¨</h4>
                            <p class="text-sm text-gray-500">æª¢æŸ¥æ©Ÿæˆ¿æ’æ°´ç³»çµ±ï¼Œç¢ºä¿ä½çªªåœ°å€è¨­å‚™æ¶é«˜ã€‚</p>
                        </div>
                        <div class="bg-white dark:bg-cardBg p-6 rounded-xl border border-gray-200 dark:border-white/5 shadow-lg">
                            <h4 class="font-bold mb-2 text-gray-700 dark:text-gray-200">é˜²ç¯„å¼·é¢¨</h4>
                            <p class="text-sm text-gray-500">åŠ å›ºæˆ¶å¤–å¤©ç·šèˆ‡é€šè¨Šå¡”ï¼Œæª¢æŸ¥å‚™ç”¨é›»æºã€‚</p>
                        </div>
                        <div class="bg-white dark:bg-cardBg p-6 rounded-xl border border-gray-200 dark:border-white/5 shadow-lg">
                            <h4 class="font-bold mb-2 text-gray-700 dark:text-gray-200">ç·Šæ€¥è¯çµ¡</h4>
                            <p class="text-sm text-gray-500">è‹¥ç™¼ç”Ÿç½å®³ï¼Œè«‹ç«‹å³é€šå ±è³‡å®‰æ‡‰è®Šä¸­å¿ƒ (SOC)ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. å€‹äººåŒ–è¨­å®šé é¢ -->
            <div id="settings-view" class="hidden-section w-full h-full flex items-start justify-center pt-10 animate-fade-in">
                <div class="w-full max-w-2xl bg-white dark:bg-cardBg rounded-2xl p-8 shadow-2xl border border-gray-200 dark:border-white/5">
                    <div class="border-b border-gray-200 dark:border-white/10 pb-6 mb-6">
                        <h2 class="text-2xl font-bold flex items-center"><i class="fas fa-sliders-h mr-3 text-blue-500"></i> å€‹äººåŒ–ä»‹é¢è¨­å®š</h2>
                        <p class="text-gray-500 text-sm mt-1">èª¿æ•´æ‚¨çš„å„€è¡¨æ¿é è¨­å€¼èˆ‡é¡¯ç¤ºåå¥½</p>
                    </div>
                    
                    <div class="space-y-8">
                        <!-- é ­åƒè¨­å®šå€å¡Š -->
                        <div class="flex items-center space-x-6">
                            <div class="relative group">
                                <img id="settings-avatar-preview" src="https://ui-avatars.com/api/?name=User&background=3b82f6&color=fff" class="w-24 h-24 rounded-full object-cover border-4 border-white/10 shadow-lg">
                                <button id="avatar-upload-btn" class="absolute bottom-0 right-0 bg-blue-600 hover:bg-blue-500 text-white rounded-full p-2 shadow-lg transition-transform transform hover:scale-110">
                                    <i class="fas fa-camera"></i>
                                </button>
                                <input type="file" id="avatar-input" class="hidden" accept="image/*">
                            </div>
                            <div>
                                <h4 class="font-bold text-lg">æ›´æ›é ­åƒ</h4>
                                <p class="text-sm text-gray-500 mb-2">æ”¯æ´ JPG, PNG (æœ€å¤§ 1MB)</p>
                                <p class="text-xs text-blue-400">é»æ“Šç›¸æ©Ÿåœ–ç¤ºé¸æ“‡åœ–ç‰‡</p>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">é è¨­ç›£æ§åŸå¸‚</label>
                            <div class="flex">
                                <span class="inline-flex items-center px-3 rounded-l-xl border border-r-0 border-gray-300 dark:border-white/10 bg-gray-50 dark:bg-white/5 text-gray-500 text-sm">
                                    <i class="fas fa-city"></i>
                                </span>
                                <input type="text" id="setting-default-city" class="flex-1 bg-white dark:bg-black/20 border border-gray-300 dark:border-white/10 rounded-r-xl px-4 py-3 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all" placeholder="ä¾‹å¦‚: å°ä¸­å¸‚">
                            </div>
                            <p class="text-xs text-gray-500 mt-2"><i class="fas fa-info-circle mr-1"></i> ç³»çµ±å°‡åœ¨ç™»å…¥æ™‚è‡ªå‹•è¼‰å…¥æ­¤åŸå¸‚çš„å¤©æ°£èˆ‡ AI é¢¨éšªåˆ†æã€‚</p>
                        </div>
                        
                        <!-- å€‹äººè³‡æ–™å€å¡Š -->
                        <div class="pt-6 border-t border-gray-200 dark:border-white/10 space-y-4">
                            <h4 class="font-bold text-gray-700 dark:text-gray-200 mb-2">å€‹äººè³‡æ–™</h4>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-1">ç”¨æˆ¶å§“å</label>
                                <input type="text" id="setting-username" class="w-full bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-2 outline-none focus:border-blue-500 transition-all" placeholder="æ‚¨çš„æš±ç¨±">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-1">è‡ªæˆ‘ä»‹ç´¹</label>
                                <textarea id="setting-bio" rows="3" class="w-full bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-2 outline-none focus:border-blue-500 transition-all resize-none" placeholder="ä»‹ç´¹ä¸€ä¸‹è‡ªå·±..."></textarea>
                            </div>
                        </div>

                        <div class="pt-4">
                            <button id="save-settings-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-blue-500/30 flex items-center justify-center">
                                <i class="fas fa-save mr-2"></i> å„²å­˜æ‰€æœ‰è®Šæ›´
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer class="p-8 text-center text-gray-500 text-xs border-t border-white/5 mt-12">
        <p>&copy; 2024 CyberWeather Pro. Powered by Groq & Open-Meteo.</p>
    </footer>

</body>

</html>

